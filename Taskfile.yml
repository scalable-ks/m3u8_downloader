version: "3"

vars:
  ANDROID_DIR: android
  RN_ANDROID_DIR: RnAndroidHlsApp/android

tasks:
  lint:js:
    desc: Run JS/TS lint
    cmds:
      - npm run lint

  test:js:
    desc: Run JS/TS unit tests
    cmds:
      - node --test --experimental-strip-types

  lint:kt:
    desc: Run Kotlin lint
    dir: "{{.ANDROID_DIR}}"
    cmds:
      - ./gradlew ktlintCheck

  test:kt:
    desc: Run Kotlin unit tests
    dir: "{{.ANDROID_DIR}}"
    cmds:
      - ./gradlew test

  test:kt:app:
    desc: Run Kotlin unit tests for RN app module
    dir: "{{.RN_ANDROID_DIR}}"
    cmds:
      - ./gradlew test

  ffmpeg:fetch:
    desc: Download ffmpeg-kit AAR into android/libs (requires FFMPEG_KIT_AAR_URL)
    cmds:
      - ./scripts/fetch_ffmpeg_kit_aar.sh

  pipe:
    desc: Run all lint and unit tests (fail fast)
    cmds:
      - task: lint:js
      - task: test:js
      - task: lint:kt
      - task: test:kt
      - task: test:kt:app
